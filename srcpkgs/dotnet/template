# Template file for 'dotnet'
pkgname=dotnet
version=6.0.302
revision=1
archs="x86_64"
wrksrc="dotnet-${version}"
build_style=meta
depends="dotnet-sdk aspnetcore-runtime dotnet-runtime dotnet-hostfxr
 dotnet-host dotnet-apphost-pack dotnet-targeting-pack aspnetcore-targeting-pack
 netstandard-targeting-pack dotnet-templates"
short_desc=".NET Core components meta package"
maintainer="Jakub Pastuszek <jpastuszek@protonmail.com>"
license="MIT"
homepage="https://dotnet.microsoft.com"
distfiles="https://download.visualstudio.microsoft.com/download/pr/0e83f50a-0619-45e6-8f16-dc4f41d1bb16/e0de908b2f070ef9e7e3b6ddea9d268c/dotnet-sdk-6.0.302-linux-x64.tar.gz"
checksum="883a25a15a6aa9d74ae35b23efdb6dced85e52b9519fc590313cec6c2626af79"
create_wrksrc=true

do_install() {
	pwd
	ls

	vmkdir usr/lib/dotnet
	vcopy dotnet usr/lib/dotnet
	vcopy host usr/lib/dotnet
	vcopy packs usr/lib/dotnet
	vcopy sdk usr/lib/dotnet
	vcopy shared usr/lib/dotnet
	vcopy templates usr/lib/dotnet

	vmkdir etc/dotnet
	echo '/usr/lib/dotnet' > "${DESTDIR}"/etc/dotnet/install_location

	vmkdir etc/profile.d
	vcopy "${FILESDIR}"/dotnet.sh etc/profile.d

	vmkdir usr/bin
	ln -s /usr/lib/dotnet/dotnet "${DESTDIR}"/usr/bin/dotnet
}

dotnet-host_package() {
	short_desc=".NET Core Command Line Interface"
	pkg_install() {
		vmove usr/lib/dotnet/dotnet
		vmove usr/bin/dotnet
		vmove etc/dotnet/install_location
		vmove etc/profile.d/dotnet.sh

		#cd "${wrksrc}"/sources/src/sdk.*/scripts
		#vcompletion register-completions.bash bash
		#vcompletion register-completions.zsh zsh
		#vcompletion "$wrksrc/sources/src/sdk.*/scripts/register-completions.bash" bash
		#vcompletion "$wrksrc/sources/src/sdk.*/scripts/register-completions.zsh" zsh

		vlicense "${wrksrc}"/LICENSE.txt
		vlicense "${wrksrc}"/ThirdPartyNotices.txt
		# there are 2 dotnet.1 manpages; one in the runtime and one in the sdk. On
		# closer inspection this one is titled dotnet-cli(1) at the top. sdk
		# manpages are included here because they are referenced by
		# dotnet-cli(1).
		#cd "${wrksrc}"/sources/src/runtime.*/docs/manpages/host
		#vman dotnet.1 dotnet-cli.1
		#cd "${wrksrc}"/sources/src/sdk.*/documentation/manpages/sdk
		#for f in *.1; do
			#vman $f
		#done
	}
}

dotnet-hostfxr_package() {
	short_desc=".NET Core Command Line Interface"
	depends="dotnet-host"
	pkg_install() {
		vmove usr/lib/dotnet/host/fxr
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

dotnet-runtime_package() {
	short_desc=".NET Core runtime"
	depends="dotnet-hostfxr"
	pkg_install() {
		vmove usr/lib/dotnet/shared/Microsoft.NETCore.App
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

aspnetcore-runtime_package() {
	short_desc="ASP.NET Core runtime"
	depends="dotnet-runtime"
	pkg_install() {
		vmove usr/lib/dotnet/shared/Microsoft.AspNetCore.App
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

dotnet-sdk_package() {
	short_desc=".NET Core SDK"
	depends="dotnet-runtime aspnetcore-runtime dotnet-targeting-pack
	 aspnetcore-targeting-pack netstandard-targeting-pack dotnet-apphost-pack
	 dotnet-templates"
	pkg_install() {
		vmove usr/lib/dotnet/sdk
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

dotnet-apphost-pack_package() {
	short_desc=".NET Core apphost pack"
	pkg_install() {
		vmove usr/lib/dotnet/packs/Microsoft.NETCore.App.Host.linux-x64
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

dotnet-targeting-pack_package() {
	short_desc=".NET Core targeting pack"
	pkg_install() {
		vmove usr/lib/dotnet/packs/Microsoft.NETCore.App.Ref
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

aspnetcore-targeting-pack_package() {
	short_desc="ASP.NET Core targeting pack"
	pkg_install() {
		vmove usr/lib/dotnet/packs/Microsoft.AspNetCore.App.Ref
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

netstandard-targeting-pack_package() {
	short_desc=".NET Standard targeting pack"
	pkg_install() {
		vmove usr/lib/dotnet/packs/NETStandard.Library.Ref
		vlicense "${wrksrc}"/LICENSE.txt
	}
}

dotnet-templates_package() {
	short_desc=".NET Core SDK templates"
	pkg_install() {
		vmove usr/lib/dotnet/templates
		vlicense "${wrksrc}"/LICENSE.txt
	}
}
